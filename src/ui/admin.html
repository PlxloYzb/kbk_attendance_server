<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBK Attendance System - Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="admin-container">
        <header class="admin-header">
            <div class="header-left">
                <h1>KBK Attendance System</h1>
                <span id="admin-info" class="admin-info"></span>
            </div>
            <div class="header-right">
                <button id="logout-btn" class="btn btn-secondary">Logout</button>
            </div>
        </header>
        
        <nav class="admin-nav">
            <button class="nav-btn active" data-section="stats">Department Statistics</button>
            <button class="nav-btn" data-section="checkin-points">Checkin Points</button>
            <button class="nav-btn" data-section="checkout-points">Checkout Points</button>
            <button class="nav-btn" data-section="users">Users</button>
            <button class="nav-btn" data-section="checkins">Checkins</button>
            <button class="nav-btn" data-section="admin-users">Admin Users</button>
            <button class="nav-btn" data-section="time-settings">Time Settings</button>
            <button class="nav-btn" data-section="sync-status">üîÑ Sync Status</button>
            <button class="nav-btn" data-section="export">Export Data</button>
        </nav>
        
        <main class="admin-content">
            <!-- Department Statistics Section -->
            <section id="stats-section" class="content-section active">
                <h2>Department Statistics</h2>
                <div id="stats-content"></div>
            </section>
            
            <!-- Checkin Points Section -->
            <section id="checkin-points-section" class="content-section">
                <h2>Checkin Points Management</h2>
                <button id="add-checkin-point-btn" class="btn btn-primary">Add Checkin Point</button>
                <div id="checkin-points-table"></div>
            </section>
            
            <!-- Checkout Points Section -->
            <section id="checkout-points-section" class="content-section">
                <h2>Checkout Points Management</h2>
                <button id="add-checkout-point-btn" class="btn btn-primary">Add Checkout Point</button>
                <div id="checkout-points-table"></div>
            </section>
            
            <!-- Users Section -->
            <section id="users-section" class="content-section">
                <h2>Users Management</h2>
                <button id="add-user-btn" class="btn btn-primary">Add User</button>
                <div id="users-table"></div>
            </section>
            
            <!-- Checkins Section -->
            <section id="checkins-section" class="content-section">
                <h2>Checkins Management</h2>
                <div class="filters">
                    <input type="text" id="checkin-user-filter" placeholder="Filter by User ID">
                    <select id="checkin-action-filter">
                        <option value="">All Actions</option>
                        <option value="IN">Check In</option>
                        <option value="OUT">Check Out</option>
                    </select>
                    <button id="apply-checkin-filter" class="btn btn-secondary">Apply Filter</button>
                </div>
                <button id="add-checkin-btn" class="btn btn-primary">Add Checkin</button>
                <div id="checkins-table"></div>
            </section>
            
            <!-- Admin Users Section -->
            <section id="admin-users-section" class="content-section">
                <h2>Admin Users Management</h2>
                <button id="add-admin-user-btn" class="btn btn-primary">Add Admin User</button>
                <div id="admin-users-table"></div>
            </section>

            <!-- Time Settings Section -->
            <section id="time-settings-section" class="content-section">
                <h2>Time Settings Management</h2>
                <p>Configure custom duty times for users. Set when each user should arrive and leave to customize late/early leave detection.</p>
                
                <div class="time-settings-filters">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="time-settings-department">Department:</label>
                            <select id="time-settings-department">
                                <option value="">All Departments</option>
                                <option value="1">1 - Office</option>
                                <option value="2">2 - Mining</option>
                                <option value="3">3 - CA</option>
                                <option value="4">4 - HR</option>
                                <option value="5">5 - Warehouse</option>
                                <option value="6">6 - Lab</option>
                                <option value="7">7 - Logistics</option>
                                <option value="8">8 - Training</option>
                                <option value="9">9 - Technic</option>
                                <option value="10">10 - Hydro</option>
                                <option value="99">99 - Standby</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <button id="load-time-settings" class="btn btn-primary">Load Users</button>
                            <button id="save-time-settings" class="btn btn-success" disabled>Save Changes</button>
                        </div>
                    </div>
                </div>
                
                <div id="time-settings-content">
                    <p class="info-text">Select a department above to load users and configure their duty times.</p>
                </div>
            </section>

            <!-- Sync Status Section -->
            <section id="sync-status-section" class="content-section">
                <h2>Sync Status</h2>
                <p>Monitor and manage data synchronization between user accounts and time settings.</p>
                
                <div class="sync-status-info">
                    <div class="status-card">
                        <h3>User Time Settings Sync</h3>
                        <div id="sync-status-display">
                            <div class="status-item">
                                <span class="label">Total Users:</span>
                                <span id="total-users-count">Loading...</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Users with Time Settings:</span>
                                <span id="users-with-settings-count">Loading...</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Sync Status:</span>
                                <span id="sync-status-indicator" class="status-badge">Loading...</span>
                            </div>
                            <div class="status-item" id="missing-users-info" style="display: none;">
                                <span class="label">Missing Settings:</span>
                                <span id="missing-users-count" class="badge badge-warning">0</span>
                            </div>
                        </div>
                        
                        <div class="sync-actions">
                            <button id="check-sync-status-btn" class="btn btn-secondary">
                                üîç Check Status
                            </button>
                            <button id="manual-sync-btn" class="btn btn-primary">
                                üîÑ Manual Sync
                            </button>
                        </div>
                        
                        <div id="sync-result" class="sync-result" style="display: none;"></div>
                    </div>
                </div>
            </section>
            
            <!-- Export Section -->
            <section id="export-section" class="content-section">
                <h2>Export Attendance Data</h2>
                <p>Export attendance summary data as CSV (Excel compatible).</p>
                <button id="export-csv-btn" class="btn btn-primary">Export as CSV</button>
            </section>
        </main>
    </div>
    
    <!-- Modal for forms -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>
    
    <script src="api.js?v=1.4"></script>
    <script src="auth.js?v=1.4"></script>
    <script src="admin.js?v=1.4"></script>
    <script>
        // Check authentication and role
        auth.checkAdminAuth();
        const user = JSON.parse(localStorage.getItem('admin_user') || '{}');
        if (user.role !== 'admin') {
            window.location.href = '/ui/department.html';
        }
        
        // Initialize admin dashboard
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('admin-info').textContent = `Welcome, ${user.username} (Admin)`;
            admin.init();
        });
    </script>
</body>
</html>